DROP DATABASE SUPPLIER ;

SHOW DATABASES;
CREATE DATABASE IF NOT EXISTS SUPPLIER;
USE SUPPLIER;

CREATE TABLE SUPPLIERS (
    SID INT PRIMARY KEY,
    SNAME VARCHAR(50),
    CITY VARCHAR(50)
);

CREATE TABLE PARTS (
    PID INT PRIMARY KEY,
    PNAME VARCHAR(50),
    COLOR VARCHAR(20)
);

CREATE TABLE CATALOG (
    SID INT,
    PID INT,
    COST INT,
    PRIMARY KEY (SID, PID),
    FOREIGN KEY (SID) REFERENCES SUPPLIERS(SID),
    FOREIGN KEY (PID) REFERENCES PARTS(PID)
);

INSERT INTO SUPPLIERS VALUES (10001, 'Acme Widget', 'Bangalore');
INSERT INTO SUPPLIERS VALUES (10002, 'Johns', 'Kolkata');
INSERT INTO SUPPLIERS VALUES (10003, 'Vimal', 'Mumbai');
INSERT INTO SUPPLIERS VALUES (10004, 'Reliance', 'Delhi');

SELECT * FROM SUPPLIERS;

INSERT INTO PARTS VALUES (20001, 'Book', 'Red');
INSERT INTO PARTS VALUES (20002, 'Pen', 'Red');
INSERT INTO PARTS VALUES (20003, 'Pencil', 'Green');
INSERT INTO PARTS VALUES (20004, 'Mobile', 'Green');
INSERT INTO PARTS VALUES (20005, 'Charger', 'Black');

SELECT * FROM PARTS;

INSERT INTO CATALOG VALUES (10001, 20001, 10),
(10001, 20002, 10),
(10001, 20003, 30),
(10001, 20005, 10),
 (10002, 20001, 10),
 (10002, 20002, 20),
 (10003, 20003, 30),
 (10004, 20003, 40);

SELECT * FROM CATALOG;

SELECT DISTINCT P.PNAME
FROM PARTS P
JOIN CATALOG C ON P.PID = C.PID;

SELECT S.SNAME
FROM SUPPLIERS S
JOIN CATALOG C ON S.SID = C.SID
GROUP BY S.SID, S.SNAME
HAVING COUNT(DISTINCT C.PID) = (SELECT COUNT(*) FROM PARTS);

SELECT S.SNAME
FROM SUPPLIERS S
WHERE NOT EXISTS (
    SELECT P.PID
    FROM PARTS P
    WHERE P.COLOR = 'Red' AND NOT EXISTS (
        SELECT *
        FROM CATALOG C
        WHERE C.SID = S.SID AND C.PID = P.PID
    )
);

SELECT P.PNAME
FROM PARTS P
JOIN CATALOG C ON P.PID = P.PID
JOIN SUPPLIERS S ON C.SID = S.SID
WHERE S.SNAME = 'Acme Widget'
  AND P.PID NOT IN (
      SELECT C2.PID
      FROM CATALOG C2
      JOIN SUPPLIERS S2 ON C2.SID = S2.SID
      WHERE S2.SNAME <> 'Acme Widget'
  );

SELECT DISTINCT C1.SID
FROM CATALOG C1
JOIN (
    SELECT PID, AVG(COST) AS AVG_COST
    FROM CATALOG
    GROUP BY PID
) AS AVG_TABLE ON C1.PID = AVG_TABLE.PID
WHERE C1.COST > AVG_TABLE.AVG_COST;


SELECT P.PNAME, S.SNAME, C.COST
FROM CATALOG C
JOIN SUPPLIERS S ON C.SID = S.SID
JOIN PARTS P ON C.PID = P.PID
WHERE (C.PID, C.COST) IN (
    SELECT PID, MAX(COST)
    FROM CATALOG
    GROUP BY PID
);

//6//
SELECT P.PNAMES
FROM PARTS P
WHERE P.PID IN (
    SELECT C.PID
    FROM CATALOG C
    WHERE C.SID NOT IN (
        SELECT S.PID
        FROM SUPPLIERS S
        WHERE S.NAME <> 'ACME WIDGET'
    )
);
